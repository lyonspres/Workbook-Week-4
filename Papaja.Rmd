---
title             : "The title"
shorttitle        : "Title"

author: 
  - name          : "First Author"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Postal address"
    email         : "my@email.com"
    role:         # Contributorship roles (e.g., CRediT, https://casrai.org/credit/)
      - Conceptualization
      - Writing - Original Draft Preparation
      - Writing - Review & Editing
  - name          : "Ernst-August Doelle"
    affiliation   : "1,2"
    role:
      - Writing - Review & Editing

affiliation:
  - id            : "1"
    institution   : "Wilhelm-Wundt-University"
  - id            : "2"
    institution   : "Konstanz Business School"

authornote: |
  Add complete departmental affiliations for each author here. Each new line herein must be indented, like this line.

  Enter author note here.

abstract: |
  One or two sentences providing a **basic introduction** to the field,  comprehensible to a scientist in any discipline.
  
  Two to three sentences of **more detailed background**, comprehensible  to scientists in related disciplines.
  
  One sentence clearly stating the **general problem** being addressed by  this particular study.
  
  One sentence summarizing the main result (with the words "**here we show**" or their equivalent).
  
  Two or three sentences explaining what the **main result** reveals in direct comparison to what was thought to be the case previously, or how the  main result adds to previous knowledge.
  
  One or two sentences to put the results into a more **general context**.
  
  Two or three sentences to provide a **broader perspective**, readily comprehensible to a scientist in any discipline.
  
  <!-- https://tinyurl.com/ybremelq -->
  
keywords          : "keywords"
wordcount         : "X"

bibliography      : ["r-references.bib"]

floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : yes
mask              : no
draft             : no

documentclass     : "apa6"
classoption       : "man"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
library("papaja")
r_refs("r-references.bib")
```

```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
```



# Methods
We report how we determined our sample size, all data exclusions (if any), all manipulations, and all measures in the study. <!-- 21-word solution (Simmons, Nelson & Simonsohn, 2012; retrieved from http://ssrn.com/abstract=2160588) -->

## Participants

## Material

## Procedure

## Data analysis
We used `r cite_r("r-references.bib")` for all our analyses.
```{r libraries}
if (!require(skimr)) install.packages('skimr')
if (!require(lubridate)) install.packages('lubridate')
if (!require(tidyverse)) install.packages('tidyverse')
if (!requireNamespace("devtools")) {
  install.packages("devtools")
}
if (!require(easystats)) devtools::install_github("easystats/easystats")
```
```{r lib2}
if (!require(ggthemes)) install.packages('ggthemes')
if (!require(pmdplyr)) install.packages("pmdplyr")
if (!require(kableExtra)) install.packages("kableExtra")
```

## Import Data

```{r data1}
nz_0 <- 
  readr::read_csv2(
    url("https://raw.githubusercontent.com/go-bayes/psych-447/main/data/nz/nz.csv")
    )
```

```{r data2}
f<-c("None Of The Time",
     "A Little Of The Time",
     "Some Of The Time",
     "Most Of The Time",
     "All Of The Time")
```

```{r tidy}
if (!require(tidyverse)) install.packages('tidyverse')
```

```{r data3}
nz <- nz_0 %>%
  dplyr::mutate_if(is.character, factor) %>%
  select(
    -c(
      SWB.Kessler01,
      SWB.Kessler02,
      SWB.Kessler03,
      SWB.Kessler04,
      SWB.Kessler05,
      SWB.Kessler06
    )
  ) %>%
  dplyr::mutate(Wave = as.factor(Wave)) %>%
  mutate(FeelHopeless = forcats::fct_relevel(FeelHopeless, f)) %>%
  mutate(FeelDepressed = forcats::fct_relevel(FeelDepressed, f)) %>%
  mutate(FeelRestless = forcats::fct_relevel(FeelRestless, f)) %>%
  mutate(EverythingIsEffort = forcats::fct_relevel(EverythingIsEffort, f)) %>%
  mutate(FeelWorthless = forcats::fct_relevel(FeelWorthless, f)) %>%
  mutate(FeelNervous = forcats::fct_relevel(FeelNervous, f)) %>%
  dplyr::mutate(Wave = as.factor(Wave)) %>%
  dplyr::mutate(date = make_date(year = 2009, month = 6, day = 30) + TSCORE)
```

Question 1
## Integer

```{r camtaylor}
nz %>%
  select(contains("hour"))
```
```{r integer22}
nz2 <- nz %>%
  mutate(Hours.Internet_int = as.integer(Hours.Internet),
  Hours.Exercise_int = as.integer(Hours.Exercise),
  Hours.Work_int = as.integer(Hours.Work),
  Hours.News_int = as.integer(Hours.News),
  HoursCharity_int = as.integer(HoursCharity))
```

```{r STD}
str(nz2)
```

Question 2a
## Scale, Center, Transform

```{r imsadrn}
nz3 <- nz2 %>%
  select(Pol.Orient, Age)%>%
  mutate(Pol.Orient1 = scale(Pol.Orient, scale = TRUE, center  = TRUE)) %>%
  mutate(Pol.Orient2 = scale(Pol.Orient, scale = FALSE, center = TRUE)) %>%
  mutate(Age1 = scale(Age, scale = FALSE, center  = TRUE)/10)
head(nz3)
```
Question 2b
## Data Wrangle

```{r wrangle}
nz4 <- nz %>%
  select(Hours.Exercise, Wave) %>%
  mutate(Hours.Exercise44 = scale(Hours.Exercise, scale = TRUE, center  = TRUE)) %>%
  filter(Wave !="2019")

## Compare

summary(nz4$Hours.Exercise44)
summary(nz4$Wave)

nz4
```

Question 3
## Working with dates

```{r wannagoonadate}
datrep <- nz %>%
  count(day = floor_date(date, "day"))%>%
  dplyr::mutate(Year = factor(ifelse(
    day < "2018-01-01",
    2017,
    ifelse(day < "2019-01-01", 2018,
           ifelse(day < "2020-01-01", 2019, 2020))
  ))) %>%
  arrange(day)
```

```{r d8m8}
datrep%>%
  arrange(desc(n))
```

Maxmimum for 2019: 54
Maximum for 2018: 112 based from the above summary and pulling the relevant dates out from it.

Question 4
## Calculating dates and creating summaries

How many days are there between the date with the highest number of responses and the date with the second highest number of responses? Pulling the relevant data from the above summary: the answer is 1 day between these dates. 

*Bonus*: Calculate difference between the number of responses on the highest response date and second highest response date? See below:

```{r BONUSyall}
112-93
```

Question 5
## Working with date intervals

```{r jordanandparis}
int<-lubridate::interval(ymd_hms("1995-12-25-05-02-22"), ymd_hms("2021-03-20-13-22-04"))
time_length(int, "month")
```

Question 6
## Create an ordered factor from numerical data

```{r factor3452}
nz7 <-nz %>%
  dplyr::mutate(relichurchy = cut(
    Religion.Church,
    breaks = c(-Inf, 0, 4, Inf),  
    labels = c("Non-attendance", "Moderate attendance", "Frequent attendance"), 
    right = TRUE
  ))
table(nz7$relichurchy, useNA = "ifany")
```

*Make sure to re-level the factor so that the ordinal ranking moves from lowest to highest - because the factors are already leveled correctly, no re-leveling is required - 
re-leveling could otherwise be done with the re-level function

Question 7a
## Make a summary table

```{r liahelper}
nz5 <- nz %>%
  select(date, HLTH.SleepHours) %>%
  mutate(Months = month(date, label = TRUE)) %>%
  group_by(Months) %>%
  arrange(Months)
```

```{r kablekable}
library(kableExtra)
nz5 %>%
  select(HLTH.SleepHours, Months) %>%
  filter(!is.na(HLTH.SleepHours))%>%
  group_by(Months) %>%
  summarise(av_sleep = mean(HLTH.SleepHours, na.rm = T))%>%
  pivot_wider(names_from = Months, values_from = av_sleep) %>%
  kbl(caption = "Average Number of Hours of Sleep by Month") %>%
   kable_classic_2(c("striped", "hover"), full_width = TRUE) %>%
  collapse_rows()
```

Question 7b
## Make a summary graph

```{r Parissavinglives}
sleep <- nz %>%
  select(date, HLTH.SleepHours) %>%
  mutate(Months = month(date, label = TRUE)) %>%
  group_by(Months) %>%
  summarise(
    mn_sleep =  mean(HLTH.SleepHours, na.rm = TRUE),
    sd_sleep =  sd(HLTH.SleepHours, na.rm = TRUE),
    n_sleep = n()
  ) %>%
  mutate(
    se_sleep = sd_sleep / sqrt(n_sleep),
    lw_ci = mn_sleep - qt(1 - (0.05 / 2), n_sleep - 1) * se_sleep,
    up_ci = mn_sleep + qt(1 - (0.05 / 2), n_sleep - 1) * se_sleep
  ) %>%
  ggplot(., aes(x = Months, y = mn_sleep, colour = mn_sleep)) +
  geom_errorbar(aes(ymin = lw_ci, ymax = up_ci), width = .1) +
  geom_point(size = 3)  +
  scale_y_continuous(limits = c(1,8)) + 
  theme_classic() + scale_fill_viridis_d()
sleep
```
Comment:

Let me have a think!

Briefly explain why some intervals are wider than others.

Question 8
## Correlation graph

```{r corrgraph}
nz8 <- nz %>%
  mutate(FeelHopeless_int = as.integer(FeelHopeless),
  FeelDepressed_int = as.integer(FeelDepressed),
  FeelRestless_int = as.integer(FeelRestless),
  EverythingIsEffort_int = as.integer(EverythingIsEffort),
  FeelWorthless_int = as.integer(FeelWorthless),
  FeelNervous_int = as.integer(FeelNervous))
```

```{r corrgraph2}
moodnz <- nz%>%
  select(
    FeelHopeless,
    FeelDepressed,
    FeelRestless,
    EverythingIsEffort,
    FeelWorthless,
    FeelNervous,
    KESSLER6sum
  ) %>%
  mutate_all(., as.numeric) %>% #make numeric 
  mutate(KESSLER6sum = as.factor(KESSLER6sum),
         FeelNervous = log(FeelNervous + 1))
```

```{r correr23r5}
library(correlation)
library(ggraph)
p1<-moodnz %>%
  correlation(partial = FALSE, multilevel = TRUE ) %>%
  plot()
```

```{r corrfinal}
moodnz %>%
  correlation(partial = FALSE, multilevel = TRUE ) %>%
  summary()
```
```{r anothercorr}
library(correlation)
p2<-moodnz %>%
  select(-KESSLER6sum)%>% # get rid of grouping variable
  correlation(partial = FALSE, multilevel = FALSE ) %>%
  plot()
```

```{r anotherone}
moodnz %>%
  select(-KESSLER6sum)%>% # get rid of grouping variable
  correlation(partial = FALSE, multilevel = FALSE ) %>%
  summary()
```
```{r plotplot}
#Comment: Johannes looked at it and can't knit to PDF
#library(patchwork)
# create a two panel plot
#p1 / p2 + 
 # plot_annotation(title = "Plot of multilevel (a) and single-level (b) correlation", #tag_levels = 'a')
```




*What do you find most interesting about this plot?* The strong correlations present between feeling worthless, depressed, and hopeless. 

**Discuss further, note the plot doesn't show me everything that's going on here people halp!

Can't see the strength of the "FeelWorthless" to "FeelDepressed" correlation

Question 9
## Create a blank papaja report

```{r papaja}
if(!"devtools" %in% rownames(installed.packages())) install.packages("devtools")
```

```{r papaJAH}

```







Question 10
## Patchwork

Use the patchwork library to create a figure with two plots on top of each other. Use the tag_levels function to index each of the two plots. The graphs should describe some dimension of the truncated nz dataset.



# Results

# Discussion


\newpage

# References

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id="refs" custom-style="Bibliography"></div>
\endgroup
